// Generated by CoffeeScript 1.3.3
var Client, ERRORS, METHODS, ahr2, apiMethod, method, simpleupc, _request;

ahr2 = require('ahr2');

simpleupc = exports;

METHODS = require('./methods');

ERRORS = require('./errors');

simpleupc.Client = Client = (function() {

  function Client(auth, version) {
    this.auth = auth;
    if (version == null) {
      version = 1;
    }
    this.url = "http://api.simpleupc.com/v" + version + ".php";
  }

  return Client;

})();

for (method in METHODS) {
  apiMethod = METHODS[method];
  Client.prototype[method] = (function(apiMethod) {
    if (method === 'products') {
      return function(params, cb) {
        _request.call(this, apiMethod, params, cb);
      };
    } else {
      return function(upc, cb) {
        _request.call(this, apiMethod, {
          upc: upc
        }, cb);
      };
    }
  })(apiMethod);
}

_request = function(method, params, cb) {
  ahr2({
    href: this.url,
    headers: {
      'Content-Type': 'application/json'
    },
    encodedBody: JSON.stringify({
      auth: this.auth,
      method: method,
      params: params
    })
  }).when(function(err, ahr, data) {
    return cb(err, data);
  });
};

simpleupc.createClient = function(apiKey, version) {
  return new Client(apiKey, version);
};
